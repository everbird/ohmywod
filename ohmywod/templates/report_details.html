{% extends "base.html" %}

{% block title %}战报 - details{% endblock %}

{% block head %}
  {{ super() }}
<style type="text/css">
  .breadcrumb {
      margin-bottom: 0px;
  }

  .breadcrumb-item {
      max-width: 40%;
  }

  .iframe-loading {
      height: calc(100vh - 72px - 36px - 113px - 56px);
  }

  .iframe-loading iframe {
      width: 100%;
      height: 100%;
      display: none;
  }

  #spinner {
      width: 100%;
      height: 100vh;
  }

  #spinner .spinner-border {
      width: 100px;
      height: 100px;
  }

  .nav-link {
      margin-top: 1em;
      margin-left: 1em;
  }

</style>
{% endblock %}

{% block content %}
<nav id="report-breadcrumb" aria-label="breadcrumb">
  <ol class="breadcrumb">
      <li class="breadcrumb-item">
         <a href="/r/">目录</a>
      </li>
      <li class="breadcrumb-item text-truncate" aria-current="page">
          <a href="{{ url_for('wodreport.view_category', category_id=report.category_id) }}">{{ report.category.title}}</a>
      </li>
      <li class="breadcrumb-item active text-truncate" aria-current="page">
          <span alt="{{ report.name }}">{{ report.title }}</span>
      </li>
  </ol>
</nav>
<div>
  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="pills-report-tab" data-bs-toggle="pill" data-bs-target="#pills-report" type="button" role="tab" aria-controls="pills-report" aria-selected="true">Report(raw)</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="pills-details-tab" data-bs-toggle="pill" data-bs-target="#pills-details" type="button" role="tab" aria-controls="pills-details" aria-selected="false">Metadata</button>
    </li>
  </ul>
</div>
<div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-report" role="tabpanel" aria-labelledby="pills-report-tab">
      <div class="embed-responsive iframe-loading">
        <div id="spinner" class="row text-center align-items-center">
          <div class="row spinner-border align-items-center mx-auto" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <iframe id="report_iframe" class="embed-responsive-item" onload="$('#spinner').hide(); $('.iframe-loading iframe').show();" src="{{ url_for("wodreport.report_raw", username=report.owner, category=report.category.name, name=report.name, subpath=subpath) }}" title="Report details"></iframe>
      </div>
    </div>
    <div class="tab-pane fade" id="pills-details" role="tabpanel" aria-labelledby="pills-details-tab">
      <table class="table">
        <tr>
          <td>ID</td>
          <td>{{ report.id }}</td>
        </tr>
        <tr>
          <td>Name</td>
          <td>{{ report.name }}</td>
        </tr>
        <tr>
          <td>Display Name</td>
          <td>{{ report.display_name }}</td>
        </tr>
        <tr>
          <td>Order</td>
          <td>{{ report.order }}</td>
        </tr>
      </table>
      <table class="table">
        <tr>
          <td>Site Name</td>
          <td>{{ details.site_name }}</td>
        </tr>
        <tr>
          <td>Name</td>
          <td>{{ details.server_name }}</td>
        </tr>
        <tr>
          <td>Group Name</td>
          <td>{{ details.group_name }}</td>
        </tr>
        <tr>
          <td>Group Size</td>
          <td>{{ details.group_size }}</td>
        </tr>
        <tr>
          <td>Dungeon Name</td>
          <td>{{ details.dungeon_name }}</td>
        </tr>
        <tr>
          <td>Dungeon Type</td>
          <td>{{ details.dungeon_type }}</td>
        </tr>
        <tr>
          <td>Dungeon Date</td>
          <td>{{ details.dungeon_date }}</td>
        </tr>
        <tr>
          <td>Challenge Name</td>
          <td>{{ details.challenge_name }}</td>
        </tr>
        <tr>
          <td>Challenge Type</td>
          <td>{{ details.challenge_type }}</td>
        </tr>
        <tr>
          <td>Challenge Floor</td>
          <td>{{ details.challenge_floors }}</td>
        </tr>
        <tr>
          <td>Succeed</td>
          <td>{{ details.succeed }}</td>
        </tr>
        <tr>
          <td>Level Min</td>
          <td>{{ details.level_min }}</td>
        </tr>
        <tr>
          <td>Level Max</td>
          <td>{{ details.level_min }}</td>
        </tr>
        <tr>
          <td>Classes</td>
          <td>{{ details.classes }}</td>
        </tr>
        <tr>
          <td>Races</td>
          <td>{{ details.races }}</td>
        </tr>
        <tr>
          <td>Classes and Races</td>
          <td>{{ details.classes_and_races }}</td>
        </tr>
        <tr>
          <td>Created At</td>
          <td>{{ details.created_at }}</td>
        </tr>
        <tr>
          <td>Updated At</td>
          <td>{{ details.updated_at }}</td>
        </tr>
      </table>
    </div>
{% endblock %}

{% block sidebar_content %}
TBD: meta for {{ report.title }}
{% endblock %}

{% block nav_content %}
<button id="fullscreen-btn" class="btn btn-secondary" role="button">全屏</button>
{% endblock %}

{% block footer %}
  {{ super() }}
<script>
  $(document).ready(function () {
      
      $("#fullscreen-btn").on("click", function () {
          var iframe_href = $("#report_iframe")[0].contentWindow.location.href;
          var reader_href = iframe_href.replace(
              "{{ url_for("wodreport.report_raw", username=report.owner, category=report.category.name, name=report.name, subpath=subpath) }}",
              "{{ url_for('wodreport.report_reader', report_id=report.id) }}"
          );
          var scroll_top = $("#report_iframe")[0].contentWindow.document.body.scrollTop;
          if (scroll_top > 0) {
              window.location.href = reader_href + "?scroll_top=" + scroll_top;
          } else {
              window.location.href = reader_href;
          }

      });
  });
</script>
{% endblock %}
